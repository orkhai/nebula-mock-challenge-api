{
  "version": 3,
  "sources": ["../../../../../src/controllers/auth/login.ts", "../../../../../src/utils/auth.ts", "../../../../../src/lib/cognitoClient.ts"],
  "sourcesContent": ["import { InitiateAuthCommand } from \"@aws-sdk/client-cognito-identity-provider\";\nimport { getSecretHash } from \"../../utils/auth\";\nimport { cognitoClient } from \"../../lib/cognitoClient\";\nimport { APIGatewayProxyHandler } from \"aws-lambda\";\n\nexport const login: APIGatewayProxyHandler = async (event: any) => {\n  const { preferred_username, password } = JSON.parse(event.body);\n\n  try {\n    if (!preferred_username || !password) {\n      return {\n        statusCode: 400,\n        body: JSON.stringify({ message: \"Missing username or password\" }),\n      };\n    }\n\n    const command = new InitiateAuthCommand({\n      AuthFlow: \"USER_PASSWORD_AUTH\",\n      ClientId: process.env.COGNITO_APP_CLIENT_ID,\n      AuthParameters: {\n        USERNAME: preferred_username,\n        PASSWORD: password,\n        SECRET_HASH: getSecretHash(preferred_username)!,\n      },\n    });\n\n    const response = await cognitoClient.send(command);\n\n    return {\n      statusCode: 200,\n      body: JSON.stringify({ token: response.AuthenticationResult }),\n    };\n  } catch (error: any) {\n    return {\n      statusCode: 400,\n      body: JSON.stringify({\n        message: error.message,\n      }),\n    };\n  }\n};\n", "import crypto from \"crypto\";\n\nexport function getSecretHash(username: string): string {\n  return crypto\n    .createHmac(\"SHA256\", process.env.COGNITO_APP_SECRET ?? \"\")\n    .update(username + (process.env.COGNITO_APP_CLIENT_ID ?? \"\"))\n    .digest(\"base64\");\n}\n", "import { CognitoIdentityProviderClient } from \"@aws-sdk/client-cognito-identity-provider\";\n\nexport const cognitoClient = new CognitoIdentityProviderClient({\n  region: process.env.AWS_REGION,\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAAA,2CAAoC;;;ACApC,oBAAmB;AAEZ,SAAS,cAAc,UAA0B;AACtD,SAAO,cAAAC,QACJ,WAAW,UAAU,QAAQ,IAAI,sBAAsB,EAAE,EACzD,OAAO,YAAY,QAAQ,IAAI,yBAAyB,GAAG,EAC3D,OAAO,QAAQ;AACpB;;;ACPA,8CAA8C;AAEvC,IAAM,gBAAgB,IAAI,sEAA8B;AAAA,EAC7D,QAAQ,QAAQ,IAAI;AACtB,CAAC;;;AFCM,IAAM,QAAgC,OAAO,UAAe;AACjE,QAAM,EAAE,oBAAoB,SAAS,IAAI,KAAK,MAAM,MAAM,IAAI;AAE9D,MAAI;AACF,QAAI,CAAC,sBAAsB,CAAC,UAAU;AACpC,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU,EAAE,SAAS,+BAA+B,CAAC;AAAA,MAClE;AAAA,IACF;AAEA,UAAM,UAAU,IAAI,6DAAoB;AAAA,MACtC,UAAU;AAAA,MACV,UAAU,QAAQ,IAAI;AAAA,MACtB,gBAAgB;AAAA,QACd,UAAU;AAAA,QACV,UAAU;AAAA,QACV,aAAa,cAAc,kBAAkB;AAAA,MAC/C;AAAA,IACF,CAAC;AAED,UAAM,WAAW,MAAM,cAAc,KAAK,OAAO;AAEjD,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,SAAS,qBAAqB,CAAC;AAAA,IAC/D;AAAA,EACF,SAAS,OAAY;AACnB,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS,MAAM;AAAA,MACjB,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": ["import_client_cognito_identity_provider", "crypto"]
}
