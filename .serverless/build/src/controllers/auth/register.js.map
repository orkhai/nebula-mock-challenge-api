{
  "version": 3,
  "sources": ["../../../../../src/controllers/auth/register.ts", "../../../../../src/utils/auth.ts", "../../../../../src/lib/cognitoClient.ts"],
  "sourcesContent": ["import { SignUpCommand } from \"@aws-sdk/client-cognito-identity-provider\";\nimport { getSecretHash } from \"../../utils/auth\";\nimport { cognitoClient } from \"../../lib/cognitoClient\";\nimport { APIGatewayProxyHandler } from \"aws-lambda\";\n\nexport const register: APIGatewayProxyHandler = async (event: any) => {\n  const { email, password, name, preferred_username } = JSON.parse(event.body);\n\n  try {\n    if (!email || !password || !name || !preferred_username) {\n      return {\n        statusCode: 400,\n        body: JSON.stringify({ message: \"Missing required fields\" }),\n      };\n    }\n\n    const command = new SignUpCommand({\n      ClientId: process.env.COGNITO_APP_CLIENT_ID,\n      SecretHash: getSecretHash(preferred_username),\n      Username: preferred_username,\n      Password: password,\n      UserAttributes: [\n        { Name: \"email\", Value: email },\n        { Name: \"name\", Value: name },\n        { Name: \"preferred_username\", Value: preferred_username },\n      ],\n    });\n\n    await cognitoClient.send(command);\n\n    return {\n      statusCode: 200,\n      body: JSON.stringify({\n        message: \"Registration successful. Check your email to confirm.\",\n      }),\n    };\n  } catch (error: any) {\n    return {\n      statusCode: 400,\n      body: JSON.stringify({\n        message: error.message,\n      }),\n    };\n  }\n};\n", "import crypto from \"crypto\";\n\nexport function getSecretHash(username: string): string {\n  return crypto\n    .createHmac(\"SHA256\", process.env.COGNITO_APP_SECRET ?? \"\")\n    .update(username + (process.env.COGNITO_APP_CLIENT_ID ?? \"\"))\n    .digest(\"base64\");\n}\n", "import { CognitoIdentityProviderClient } from \"@aws-sdk/client-cognito-identity-provider\";\n\nexport const cognitoClient = new CognitoIdentityProviderClient({\n  region: process.env.AWS_REGION,\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAAA,2CAA8B;;;ACA9B,oBAAmB;AAEZ,SAAS,cAAc,UAA0B;AACtD,SAAO,cAAAC,QACJ,WAAW,UAAU,QAAQ,IAAI,sBAAsB,EAAE,EACzD,OAAO,YAAY,QAAQ,IAAI,yBAAyB,GAAG,EAC3D,OAAO,QAAQ;AACpB;;;ACPA,8CAA8C;AAEvC,IAAM,gBAAgB,IAAI,sEAA8B;AAAA,EAC7D,QAAQ,QAAQ,IAAI;AACtB,CAAC;;;AFCM,IAAM,WAAmC,OAAO,UAAe;AACpE,QAAM,EAAE,OAAO,UAAU,MAAM,mBAAmB,IAAI,KAAK,MAAM,MAAM,IAAI;AAE3E,MAAI;AACF,QAAI,CAAC,SAAS,CAAC,YAAY,CAAC,QAAQ,CAAC,oBAAoB;AACvD,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU,EAAE,SAAS,0BAA0B,CAAC;AAAA,MAC7D;AAAA,IACF;AAEA,UAAM,UAAU,IAAI,uDAAc;AAAA,MAChC,UAAU,QAAQ,IAAI;AAAA,MACtB,YAAY,cAAc,kBAAkB;AAAA,MAC5C,UAAU;AAAA,MACV,UAAU;AAAA,MACV,gBAAgB;AAAA,QACd,EAAE,MAAM,SAAS,OAAO,MAAM;AAAA,QAC9B,EAAE,MAAM,QAAQ,OAAO,KAAK;AAAA,QAC5B,EAAE,MAAM,sBAAsB,OAAO,mBAAmB;AAAA,MAC1D;AAAA,IACF,CAAC;AAED,UAAM,cAAc,KAAK,OAAO;AAEhC,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAY;AACnB,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS,MAAM;AAAA,MACjB,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": ["import_client_cognito_identity_provider", "crypto"]
}
